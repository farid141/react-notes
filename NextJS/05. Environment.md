# Environment

Mari kita bahas secara teknis dan tuntas, dari **penempatan file**, **naming rules**, sampai **penggunaan di kode** dan **build-time behavior**.

## üì¶ 1. Tempat menyimpan environment variable

Kamu taruh file environment di root proyek (satu level dengan `package.json`):

```bash
my-app/
‚îú‚îÄ app/
‚îú‚îÄ .env.local
‚îú‚îÄ .env.development
‚îú‚îÄ .env.production
‚îú‚îÄ next.config.js
‚îî‚îÄ package.json
```

Urutan prioritas pemuatan:

1. `.env.local` (paling tinggi, cocok untuk dev lokal)
2. `.env.development` atau `.env.production` tergantung mode
3. `.env` (default fallback)

Contoh isi `.env.local`:

```bash
DATABASE_URL="postgres://user:pass@localhost:5432/mydb"
NEXT_PUBLIC_API_URL="http://localhost:3000/api"
```

## ‚öôÔ∏è 2. Akses dari **Server Component / Server Code**

Untuk file yang hanya dijalankan di server (misalnya `app/api/.../route.ts` atau fungsi di backend),
gunakan **`process.env.VARIABLE_NAME`** langsung.

**Contoh:**

```ts
// app/api/users/route.ts
export async function GET() {
  const dbUrl = process.env.DATABASE_URL; // aman di server
  return Response.json({ dbUrl });
}
```

> Nilai ini **tidak akan pernah bocor ke browser**, karena hanya dibaca di server.

## üåê 3. Akses dari **Client Component / Browser**

Di sisi client, Next.js **tidak akan mengekspos env variable apa pun kecuali yang diawali dengan `NEXT_PUBLIC_`**.

**Contoh:**

```bash
NEXT_PUBLIC_API_URL="https://myapi.com"
```

Lalu di kode:

```tsx
"use client";

export default function Example() {
  console.log(process.env.NEXT_PUBLIC_API_URL); // ‚úÖ bisa diakses
  console.log(process.env.DATABASE_URL);        // ‚ùå undefined di browser
  return <p>API URL: {process.env.NEXT_PUBLIC_API_URL}</p>;
}
```

## üèóÔ∏è 4. Mode development dan production

Next.js otomatis memilih env berdasarkan mode:

| Mode        | File yang dipakai                   | Perintah                         |
| ----------- | ----------------------------------- | -------------------------------- |
| Development | `.env.local` dan `.env.development` | `npm run dev`                    |
| Production  | `.env.production`                   | `npm run build && npm run start` |

> Kamu juga bisa override manual:
>
> ```bash
> NODE_ENV=production npm run dev
> ```

## üß™ 5. Menggunakan env di **next.config.js**

Kadang kamu butuh env di level konfigurasi Next.js.

```js
// next.config.js
const nextConfig = {
  env: {
    CUSTOM_ENV: process.env.CUSTOM_ENV,
  },
};

module.exports = nextConfig;
```

> Nilai yang ditaruh di `env:` akan di-‚Äúinjeksi‚Äù ke semua environment runtime,
> **tapi hati-hati**: semuanya otomatis jadi publik (terekspor ke client bundle).
> Jadi lebih baik gunakan file `.env` langsung ketimbang mendefinisikan di sini.

---

## üß∞ 6. Menggunakan env di **`fetch` atau API URL**

Dalam `app/page.tsx` misalnya:

```tsx
export default async function Page() {
  const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/users`);
  const data = await res.json();

  return <pre>{JSON.stringify(data, null, 2)}</pre>;
}
```

Atau di `next.config.js` untuk basePath, image domain, dll:

```js
// next.config.js
module.exports = {
  images: {
    domains: [process.env.NEXT_PUBLIC_IMAGE_DOMAIN],
  },
};
```

## üß© 7. Tips penting

1. **Restart server** setiap kali kamu ubah file `.env`.

   > Next.js tidak auto-reload environment variable.
2. **Jangan commit `.env.local`** ke Git (karena biasanya berisi kredensial).

   > Tambahkan ke `.gitignore`.
3. Kalau deploy ke **Vercel**, env variable bisa diatur lewat UI ‚ÄúProject Settings ‚Üí Environment Variables‚Äù.
4. Gunakan library seperti `zod` atau `envsafe` untuk **validasi env di runtime** agar tidak error silent.

## Contoh lengkap minimal

`.env.local`

```bash
DATABASE_URL="postgres://user:pass@localhost:5432/mydb"
NEXT_PUBLIC_API_URL="http://localhost:3000/api"
```

`app/api/test/route.ts`

```ts
export async function GET() {
  return Response.json({
    db: process.env.DATABASE_URL, // server-only
    publicApi: process.env.NEXT_PUBLIC_API_URL, // bisa juga diakses dari client
  });
}
```

`app/page.tsx`

```tsx
export default async function Page() {
  const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/test`);
  const json = await res.json();
  return <pre>{JSON.stringify(json, null, 2)}</pre>;
}
```
